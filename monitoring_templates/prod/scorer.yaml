channels:
  email:
    email_alert:
      recipients: ['chibox-team@allegro.pl']
  pagerduty:
    pagerduty_alert:
      incident_format: Rate of http errors in chi-client-scorer is > 0

sources:
  graphite:
    offers_update_error_rate:
      metric: sumSeries(stats.*.*.*.*.chi.client.offer.scorer.offers.set.error.m1_rate)
    parameters_get_error_rate:
      metric: sumSeries(stats.*.*.*.*.chi.client.offer.scorer.priors.refresh.error.m1_rate)

checks:
  last_offers_update_error_rate:
    sources: ['offers_update_error_rate']
    frequency: 1
    triggers:
      - rule: offers_update_error_rate.values > 0
        debounce: 2
        severity: critical
        notify: ['pagerduty_alert']

  last_parameters_get_error_rate:
    sources: ['parameters_get_error_rate']
    frequency: 1
    triggers:
      - rule: parameters_get_error_rate.values > 0
        debounce: 2
        severity: critical
        notify: ['pagerduty_alert']